<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Starlight PageTest</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  height: 100vh;
  display: flex;
  font-family: Consolas, Monaco, monospace;
  background: #0f111a;
  color: #e6e6e6;
}

#editor-panel {
  width: 50%;
  display: flex;
  flex-direction: column;
  background: #151823;
}

#editor-header {
  padding: 10px;
  background: #1b1f2f;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#run-btn {
  background: #61dafb;
  border: none;
  padding: 6px 14px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
}

#editor {
  flex: 1;
  padding: 12px;
  outline: none;
  white-space: pre;
  overflow: auto;
  caret-color: #61dafb;
}

/* Syntax colors */
.tag { color: #e06c75; }
.css { color: #61afef; }
.js { color: #c678dd; }
.comment { color: #5c6370; }

#preview-panel {
  width: 50%;
  position: relative;
  background: white;
}

#logo {
  position: absolute;
  top: 10px;
  right: 10px;
  height: 32px;
  z-index: 5;
}

iframe {
  width: 100%;
  height: 100%;
  border: none;
}
</style>
</head>

<body>

<!-- EDITOR -->
<div id="editor-panel">
  <div id="editor-header">
    <strong>Starlight Editor</strong>
    <button id="run-btn">â–¶ Run</button>
  </div>

  <div id="editor" contenteditable="true">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;style&gt;
body {
  background: #111;
  color: white;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Hello Starlight&lt;/h1&gt;
&lt;script&gt;
console.log("Ready");
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
  </div>
</div>

<!-- PREVIEW -->
<div id="preview-panel">
  <img id="logo" src="https://dominexmacedon.github.io/starlight-programming-language/logo/starlight-lang-logo.png">
  <iframe id="preview"></iframe>
</div>

<script>
const editor = document.getElementById("editor");
const preview = document.getElementById("preview");
const runBtn = document.getElementById("run-btn");

/* Syntax highlighting */
function highlight() {
  let html = editor.innerText
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;");

  html = html.replace(/(&lt;!--[\s\S]*?--&gt;)/g,'<span class="comment">$1</span>');
  html = html.replace(/(&lt;[^&]*&gt;)/g,'<span class="tag">$1</span>');
  html = html.replace(/(\{[\s\S]*?\})/g,'<span class="css">$1</span>');
  html = html.replace(/\b(let|const|var|function|if|else|for|while|return)\b/g,'<span class="js">$1</span>');

  editor.innerHTML = html;
  placeCursorAtEnd(editor);
}

/* Keep cursor stable */
function placeCursorAtEnd(el) {
  const range = document.createRange();
  const sel = window.getSelection();
  range.selectNodeContents(el);
  range.collapse(false);
  sel.removeAllRanges();
  sel.addRange(range);
}

editor.addEventListener("input", highlight);

/* Auto-close brackets */
editor.addEventListener("keydown", e => {
  const pairs = { "{":"}", "(":")", "[":"]", "\"":"\"", "'":"'" };
  if (pairs[e.key]) {
    e.preventDefault();
    document.execCommand("insertText", false, e.key + pairs[e.key]);
    document.execCommand("moveBackward");
  }
});

/* Run */
runBtn.onclick = () => {
  preview.srcdoc = editor.innerText;
};

preview.srcdoc = editor.innerText;
</script>

</body>
</html>
