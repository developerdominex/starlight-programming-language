<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Starlight Page Test</title>

  <link rel="icon" href="https://dominexmacedon.github.io/starlight-programming-language/logo/starlight-lang-logo.png">

  <!-- CodeMirror -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>

  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #1e1e1e;
      color: #e0e0e0;
      font-family: Segoe UI, sans-serif;
      display: flex;
      flex-direction: column;
    }

    header {
      background: #282c34;
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    main {
      flex: 1;
      display: flex;
    }

    #editor-container, #output-container {
      width: 50%;
      position: relative;
    }

    /* Tabs */
    .tabs {
      display: flex;
      background: #111;
    }

    .tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      color: #aaa;
      border-bottom: 2px solid transparent;
    }

    .tab.active {
      color: #61dafb;
      border-bottom: 2px solid #61dafb;
    }

    .editor {
      height: calc(100% - 34px);
      display: none;
    }

    .editor.active {
      display: block;
    }

    .CodeMirror {
      height: 100%;
    }

    /* Run button */
    .run-container {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }

    #run-btn {
      padding: 0.3rem 0.8rem;
      background: #61dafb;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }

    /* Output */
    #output-container {
      background: white;
      border-left: 2px solid #61dafb;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Console overlay */
    #console {
      position: absolute;
      bottom: 0;
      width: 100%;
      max-height: 40%;
      overflow-y: auto;
      background: #111;
      color: #0f0;
      font-size: 0.85rem;
      padding: 0.5rem;
      font-family: monospace;
      border-top: 2px solid #61dafb;
    }

    .error { color: #ff4d4d; }
    .warn { color: #ffd166; }
  </style>
</head>

<body>

<header>
  <h1>Starlight Page Test</h1>
</header>

<div class="run-container">
  <button id="run-btn">â–¶ Run</button>
</div>

<main>
  <div id="editor-container">
    <div class="tabs">
      <div class="tab active" data-tab="html">HTML</div>
      <div class="tab" data-tab="js">JavaScript</div>
    </div>

    <div id="html" class="editor active">
      <textarea id="html-editor">
<!DOCTYPE html>
<html>
<body>
  <h1>Hello Starlight!</h1>
  <p>Open console output below ðŸ‘‡</p>
</body>
</html>
      </textarea>
    </div>

    <div id="js" class="editor">
      <textarea id="js-editor">
console.log("JS is working!");
// Try: undefinedVariable
      </textarea>
    </div>
  </div>

  <div id="output-container">
    <iframe id="preview"></iframe>
    <div id="console"></div>
  </div>
</main>

<script>
  const htmlEditor = CodeMirror.fromTextArea(
    document.getElementById("html-editor"),
    { mode: "htmlmixed", theme: "dracula", lineNumbers: true }
  );

  const jsEditor = CodeMirror.fromTextArea(
    document.getElementById("js-editor"),
    { mode: "javascript", theme: "dracula", lineNumbers: true }
  );

  // Tabs
  document.querySelectorAll(".tab").forEach(tab => {
    tab.onclick = () => {
      document.querySelectorAll(".tab, .editor").forEach(el => el.classList.remove("active"));
      tab.classList.add("active");
      document.getElementById(tab.dataset.tab).classList.add("active");
    };
  });

  const runBtn = document.getElementById("run-btn");
  const iframe = document.getElementById("preview");
  const consoleBox = document.getElementById("console");

  runBtn.onclick = () => {
    consoleBox.innerHTML = "";

    const html = htmlEditor.getValue();
    const js = jsEditor.getValue();

    iframe.srcdoc = `
      ${html}
      <script>
        const send = (type, msg) =>
          parent.postMessage({ type, msg }, "*");

        console.log = (...a) => send("log", a.join(" "));
        console.error = (...a) => send("error", a.join(" "));
        console.warn = (...a) => send("warn", a.join(" "));

        window.onerror = (m,l) =>
          send("error", m + " (line " + l + ")");

        try { ${js} } catch(e) { console.error(e.message); }
      <\/script>
    `;
  };

  window.addEventListener("message", e => {
    const div = document.createElement("div");
    div.className = e.data.type;
    div.textContent = `[${e.data.type}] ${e.data.msg}`;
    consoleBox.appendChild(div);
  });
</script>

</body>
</html>
